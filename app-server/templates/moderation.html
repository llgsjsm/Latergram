{% extends "base.html" %}

{% block content %}
<h2>Moderation Dashboard</h2>
<div class="container mt-4">
<h3>Moderation Report Queue</h3>
<div class="table-responsive">
    <table class="table table-dark table-bordered table-hover align-middle rounded">
        <thead class="table-dark">
            <tr>
                <th scope="col">Report ID</th>
                <th scope="col">Reported By</th>
                <th scope="col">Reviewed By</th>
                <th scope="col">Target Type</th>
                <th scope="col">Reason</th>
                <th scope="col">Status</th>
                <th scope="col">Created At</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>
                    <a class="text-decoration-none fw-bold"  href="{{ url_for('report_detail', report_id=report.reportId) }}">
                        {{ report.reportId }}
                    </a>
                </td>
                <td>
                    {% if report.reporter %}
                    <a class="text-decoration-none fw-bold" href="{{ url_for('profile', user_id=report.reporter.userId) }}">
                        {{ report.reporter.username }}
                    </a>
                    {% else %}
                    Unknown
                    {% endif %}
                </td>
                <td>
                    {% if report.reviewer %}
                    <a class="text-decoration-none fw-bold" href="{{ url_for('profile', user_id=report.reviewer.modID) }}">
                        {{ report.reviewer.username }}
                    </a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ report.targetType }}</td>
                <td>{{ report.reason }}</td>
                <td>{{ report.status }}</td>
                <td>{{ report.timestamp }}</td>
                <td>
                    <div class="btn-group" role="group">
                        {% if report.status == 'Pending' %}
                        <form method="post" style="display:inline; margin-right: 8px;" action="{{ url_for('moderation_action', action='review', report_id=report.reportId) }}"
                            style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-primary" title="Review">
                                <i class="fas fa-eye"></i> Review
                            </button>
                        </form>
                        <form method="post" style="display:inline; margin-right: 8px;" action="{{ url_for('moderation_action', action='reject', report_id=report.reportId) }}"
                            style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-warning" title="Reject">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </form>
                        {% elif report.status == 'UnderReview' %}
                        <form method="post" style="display:inline; margin-right: 8px;" action="{{ url_for('moderation_action', action='resolve', report_id=report.reportId) }}"
                            style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-success" title="Resolve">
                                <i class="fas fa-check"></i> Resolve
                            </button>
                        </form>
                        <form method="post" style="display:inline; margin-right: 8px;" action="{{ url_for('moderation_action', action='reject', report_id=report.reportId) }}"
                            style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-warning" title="Reject">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </form>
                        {% elif report.status == 'Resolved' %}
                        <span class="badge bg-success">Resolved</span>
                        {% elif report.status == 'Rejected' %}
                        <span class="badge bg-secondary">Rejected</span>
                        {% endif %}
                    </div>           
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8">No pending reports.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <h3>Full Report History</h3>
    <div class="table-responsive">
        <table class="table table-dark table-bordered table-hover align-middle rounded">
            <thead class="table-dark">
                <tr>
                    <th scope="col">Report ID</th>
                    <th scope="col">Reported By</th>
                    <th scope="col">Reviewed By</th>
                    <th scope="col">Target Type</th>
                    <th scope="col">Reason</th>
                    <th scope="col">Status</th>
                    <th scope="col">Created At</th>
                </tr>
            </thead>
            <tbody>
                {% for report in paginated_reports.items %}
                <tr>
                    <td>
                        <a class="text-decoration-none fw-bold"
                            href="{{ url_for('report_detail', report_id=report.reportId) }}">
                            {{ report.reportId }}
                        </a>
                    </td>
                    <td>
                        {% if report.reporter %}
                        <a class="text-decoration-none fw-bold"
                            href="{{ url_for('profile', user_id=report.reporter.userId) }}">
                            {{ report.reporter.username }}
                        </a>
                        {% else %}
                        Unknown
                        {% endif %}
                    </td>
                    <td>
                        {% if report.reviewer %}
                        <a class="text-decoration-none fw-bold"
                            href="{{ url_for('profile', user_id=report.reviewer.modID) }}">
                            {{ report.reviewer.username }}
                        </a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>{{ report.targetType }}</td>
                    <td>{{ report.reason }}</td>
                    <td>{{ report.status }}</td>
                    <td>{{ report.timestamp }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7">No reports found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <!-- Pagination controls -->
        <nav>
            <ul class="pagination justify-content-center">
                {% if paginated_reports.has_prev %}
                <li class="page-item">
                    <a class="page-link bg-dark text-light" href="{{ url_for('moderation', page=paginated_reports.prev_num) }}">Previous</a>
                </li>
                {% else %}
                <li class="page-item disabled"><span class="page-link  bg-dark text-light">Previous</span></li>
                {% endif %}
                {% for p in range(1, paginated_reports.pages + 1) %}
                <li class="page-item {% if paginated_reports.page == p %}active{% endif %}">
                    <a class="page-link bg-dark text-light" href="{{ url_for('moderation', page=p) }}">{{ p }}</a>
                </li>
                {% endfor %}
                {% if paginated_reports.has_next %}
                <li class="page-item">
                    <a class="page-link bg-dark text-light" href="{{ url_for('moderation', page=paginated_reports.next_num) }}">Next</a>
                </li>
                {% else %}
                <li class="page-item disabled"><span class="page-link bg-dark text-light">Next</span></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endblock %}